pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	map_end=32*8
	create_map(32,32)
	create_player(0,0)
	cam_x=0
	cam_y=0
end

function _update()
	update_player()
	cam_x=p.x-64+4
	cam_y=p.y-64+4
	if cam_x<0 then
		cam_x=0
	end
	if cam_x>map_end-128 then
		cam_x=map_end-128
	end
	if cam_y<0 then
		cam_y=0
	end
	if cam_y>map_end-128 then
		cam_y=map_end-128
	end
	camera(cam_x,cam_y)
end

function _draw()
 cls()
	draw_map()
	draw_player()
end
-->8
function create_player(x,y)
	p={}
	p.x=x
	p.y=x
	p.v_spr=4
	p.h_spr=5
	p.dir=1
end

function update_player()
	if btnp(⬆️) then
		p.y-=8
		p.dir=1
	elseif btnp(➡️) then
		p.x+=8
		p.dir=2
	elseif btnp(⬇️) then
		p.y+=8
		p.dir=3
	elseif btnp(⬅️) then
		p.x-=8
		p.dir=4
	end
end

function draw_player()
	if p.dir==1 then
		spr(p.v_spr,p.x,p.y)
	elseif p.dir==2 then
		spr(p.h_spr,p.x,p.y)
	elseif p.dir==3 then
		spr(p.v_spr,p.x,p.y,1,1,false,true)
	else
		spr(p.h_spr,p.x,p.y,1,1,true,false)
	end
end
-->8
function create_map(width, height)
	m={}
	for x=0,width-1 do
		m[x]={}
		for y=0,height-1 do
			if flr(rnd(4))==0 then
				m[x][y]={t="water",s=1}	
			else
				m[x][y]={t="water",s=17}
			end
		end
	end
	
	for i=0,(width/2) do
		generate_lily(width-1,height-1)
	end
end

function generate_lily(x_bound,y_bound)
	local x=flr(rnd(x_bound))
	local y=flr(rnd(y_bound))
	if m[x][y].t=="water" and
				m[x+1][y].t=="water" and
				m[x][y+1].t=="water" and
				m[x+1][y+1].t=="water" then
		m[x][y]={t="lily",s=2}
		m[x+1][y]={t="lily",s=3}
		m[x][y+1]={t="lily",s=18}
		m[x+1][y+1]={t="lily",s=19}
	end
end

function draw_map()
	for x=0,#m do
		for y=0,#m[x] do
			spr(m[x][y].s,x*8,y*8)
		end
	end
end
__gfx__
00000000cccccccccccccccccccccccc001331000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cc7c7ccccccccccccccccccc303bb3033330030000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700c7c7cccccccccbbbbbbbcccc03bbbb3000333b3100000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000cccccccccccbbbbbbbb3cccc003bb300003bbbb300000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ccccccccccbbbbbbbb3ccccc003bb300003bbbb300000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700cccc7c7cccbbbbbbb3cccccc0333333000333b3100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccc7c7ccc3bbbbbb3ccccccc030000303330030000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc3bbbbbbbbbbbbbc030000300000003000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc3bbbbbbbbbbbbbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc3bbbbbbbbbbbbbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccc3bbbbbbbbbbbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccc3bbbbbbbbbbbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccc33bbbbbbbbccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccccc333333ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
